generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_DATABASE_URL")
}

model Athlete {
  id                      String                   @id @default(cuid())
  firebaseId              String                   @unique
  email                   String?
  companyId               String
  firstName               String?
  lastName                String?
  gofastHandle            String?                  @unique
  photoURL                String?
  phoneNumber             String?
  birthday                DateTime?
  gender                  String?
  city                    String?
  state                   String?
  primarySport            String?
  bio                     String?
  instagram               String?
  garmin_user_id          String?                  @unique
  garmin_access_token     String?
  garmin_refresh_token    String?
  garmin_expires_in       Int?
  garmin_scope            String?
  garmin_connected_at     DateTime?
  garmin_last_sync_at     DateTime?
  garmin_is_connected     Boolean                  @default(false)
  garmin_disconnected_at  DateTime?
  garmin_permissions      Json?
  garmin_user_profile     Json?
  garmin_user_sleep       Json?
  garmin_user_preferences Json?
  strava_id               Int?                     @unique
  strava_access_token     String?
  strava_refresh_token    String?
  strava_expires_at       Int?
  fiveKPace               String?
  weeklyMileage           Int?
  createdAt               DateTime                 @default(now())
  updatedAt               DateTime                 @updatedAt
  goFastCompany           GoFastCompany            @relation(fields: [companyId], references: [id], onDelete: Cascade)
  athlete_activities      athlete_activities[]
  run_crew_announcements  run_crew_announcements[]
  run_crew_event_rsvps    run_crew_event_rsvps[]
  run_crew_events         run_crew_events[]
  run_crew_managers       run_crew_managers[]
  run_crew_memberships    run_crew_memberships[]
  run_crew_messages       run_crew_messages[]
  run_crew_run_rsvps      run_crew_run_rsvps[]
  run_crew_runs           run_crew_runs[]
  training_days_executed  training_days_executed[]
  training_plans          training_plans[]
}

model ai_roles {
  id                   String                 @id
  name                 String
  content              String
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  training_gen_prompts training_gen_prompts[]
}

model athlete_activities {
  id               String    @id
  athleteId        String
  sourceActivityId String    @unique
  source           String    @default("garmin")
  activityType     String?
  activityName     String?
  startTime        DateTime?
  duration         Int?
  distance         Float?
  calories         Int?
  averageSpeed     Float?
  averageHeartRate Int?
  maxHeartRate     Int?
  elevationGain    Float?
  steps            Int?
  startLatitude    Float?
  startLongitude   Float?
  endLatitude      Float?
  endLongitude     Float?
  summaryPolyline  String?
  summaryData      Json?
  detailData       Json?
  hydratedAt       DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime
  Athlete          Athlete   @relation(fields: [athleteId], references: [id], onDelete: Cascade)
}

model GoFastCompany {
  id        String    @id @default(cuid())
  name      String?
  slug      String?   @unique
  address   String?
  city      String?
  state     String?
  zip       String?
  domain    String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  Athlete   Athlete[]

  @@map("go_fast_companies")
}

model join_codes {
  id        String    @id
  code      String    @unique
  runCrewId String
  createdAt DateTime  @default(now())
  expiresAt DateTime?
  isActive  Boolean   @default(true)
  run_crews run_crews @relation(fields: [runCrewId], references: [id], onDelete: Cascade)
}

model must_haves {
  id                   String                 @id
  name                 String
  fields               Json
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  training_gen_prompts training_gen_prompts[]
}

model prompt_instructions {
  id                   String                @id
  promptId             String?
  title                String
  content              String
  order                Int                   @default(0)
  createdAt            DateTime              @default(now())
  updatedAt            DateTime
  training_gen_prompts training_gen_prompts? @relation(fields: [promptId], references: [id], onDelete: Cascade)

  @@index([promptId, order])
}

model race_registry {
  id                      String                    @id
  name                    String
  raceType                String
  miles                   Float
  date                    DateTime
  city                    String?
  state                   String?
  country                 String?
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime                  @updatedAt
  training_plans          training_plans[]
  run_crew_specific_races run_crew_specific_races[]
}

model return_json_formats {
  id                   String                 @id
  name                 String
  schema               Json
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  example              Json?
  training_gen_prompts training_gen_prompts[]
}

model rule_set_items {
  id              String          @id
  topicId         String
  text            String
  createdAt       DateTime        @default(now())
  updatedAt       DateTime
  rule_set_topics rule_set_topics @relation(fields: [topicId], references: [id])
}

model rule_set_topics {
  id             String           @id
  rulesetId      String
  name           String
  createdAt      DateTime         @default(now())
  updatedAt      DateTime
  rule_set_items rule_set_items[]
  rule_sets      rule_sets        @relation(fields: [rulesetId], references: [id])
}

model rule_sets {
  id                   String                 @id
  name                 String
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  rule_set_topics      rule_set_topics[]
  training_gen_prompts training_gen_prompts[]
}

model run_crew_announcements {
  id         String    @id @default(cuid())
  runCrewId  String
  authorId   String
  title      String
  content    String
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  archivedAt DateTime? @db.Timestamp(6)
  Athlete    Athlete   @relation(fields: [authorId], references: [id], onDelete: Cascade)
  run_crews  run_crews @relation(fields: [runCrewId], references: [id], onDelete: Cascade)
}

model run_crew_event_rsvps {
  id              String          @id
  eventId         String
  athleteId       String
  status          String
  createdAt       DateTime        @default(now())
  Athlete         Athlete         @relation(fields: [athleteId], references: [id], onDelete: Cascade)
  run_crew_events run_crew_events @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@unique([eventId, athleteId])
}

model run_crew_events {
  id                   String                 @id @default(cuid())
  runCrewId            String
  organizerId          String
  title                String
  date                 DateTime
  time                 String
  location             String
  address              String?
  description          String?
  eventType            String?
  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @updatedAt
  run_crew_event_rsvps run_crew_event_rsvps[]
  Athlete              Athlete                @relation(fields: [organizerId], references: [id], onDelete: Cascade)
  run_crews            run_crews              @relation(fields: [runCrewId], references: [id], onDelete: Cascade)
}

model run_crew_managers {
  id        String    @id
  runCrewId String
  athleteId String
  role      String
  createdAt DateTime  @default(now())
  Athlete   Athlete   @relation(fields: [athleteId], references: [id], onDelete: Cascade)
  run_crews run_crews @relation(fields: [runCrewId], references: [id], onDelete: Cascade)

  @@unique([runCrewId, athleteId])
}

model run_crew_memberships {
  id        String      @id @default(cuid())
  runCrewId String
  athleteId String
  joinedAt  DateTime    @default(now())
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  role      RunCrewRole @default(member)
  Athlete   Athlete     @relation(fields: [athleteId], references: [id], onDelete: Cascade)
  run_crews run_crews   @relation(fields: [runCrewId], references: [id], onDelete: Cascade)

  @@unique([runCrewId, athleteId])
  @@index([runCrewId, role])
}

model run_crew_messages {
  id        String    @id @default(cuid())
  runCrewId String
  athleteId String
  content   String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  topic     String    @default("general")
  Athlete   Athlete   @relation(fields: [athleteId], references: [id], onDelete: Cascade)
  run_crews run_crews @relation(fields: [runCrewId], references: [id], onDelete: Cascade)
}

model run_crew_run_rsvps {
  id            String        @id @default(cuid())
  runId         String
  athleteId     String
  status        String
  createdAt     DateTime      @default(now())
  Athlete       Athlete       @relation(fields: [athleteId], references: [id], onDelete: Cascade)
  run_crew_runs run_crew_runs @relation(fields: [runId], references: [id], onDelete: Cascade)

  @@unique([runId, athleteId])
}

model run_crew_runs {
  id                 String               @id @default(cuid())
  runCrewId          String
  createdById        String
  title              String
  runType            String               @default("single")
  date               DateTime
  startTime          String
  timezone           String?
  meetUpPoint        String
  meetUpAddress      String?
  meetUpPlaceId      String?
  meetUpLat          Float?
  meetUpLng          Float?
  recurrenceRule     String?
  recurrenceEndsOn   DateTime?
  recurrenceNote     String?
  totalMiles         Float?
  pace               String?
  stravaMapUrl       String?
  description        String?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  run_crew_run_rsvps run_crew_run_rsvps[]
  Athlete            Athlete              @relation(fields: [createdById], references: [id], onDelete: Cascade)
  run_crews          run_crews            @relation(fields: [runCrewId], references: [id], onDelete: Cascade)
}

model run_crews {
  id                      String                    @id @default(cuid())
  name                    String
  description             String?
  joinCode                String                    @unique
  logo                    String?
  icon                    String?
  archivedAt              DateTime?
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime                  @updatedAt
  messageTopics           Json?
  city                    String?
  paceMin                 Int?
  paceMax                 Int?
  ageMin                  Int?
  ageMax                  Int?
  primaryMeetUpPoint      String?
  primaryMeetUpAddress    String?
  primaryMeetUpPlaceId    String?
  primaryMeetUpLat        Float?
  primaryMeetUpLng        Float?
  gender                  Gender?
  state                   State?
  typicalRunMiles         Float?
  longRunMilesMin         Float?
  longRunMilesMax         Float?
  timePreference          TimePreference[]          @default([])
  purpose                 Purpose[]                 @default([])
  trainingForRace         String? // race_registry.id (nullable)
  trainingForDistance     TrainingForDistance[]     @default([])
  join_codes              join_codes[]
  run_crew_specific_races run_crew_specific_races[]
  run_crew_announcements  run_crew_announcements[]
  run_crew_events         run_crew_events[]
  run_crew_managers       run_crew_managers[]
  run_crew_memberships    run_crew_memberships[]
  run_crew_messages       run_crew_messages[]
  run_crew_runs           run_crew_runs[]
}

model run_crew_specific_races {
  id             String        @id @default(cuid())
  runCrewId      String
  raceRegistryId String
  createdAt      DateTime      @default(now())
  run_crews      run_crews     @relation(fields: [runCrewId], references: [id], onDelete: Cascade)
  race_registry  race_registry @relation(fields: [raceRegistryId], references: [id], onDelete: Cascade)

  @@unique([runCrewId, raceRegistryId])
}

model training_days_executed {
  id          String   @id
  athleteId   String
  activityId  String?  @unique
  weekIndex   Int
  dayIndex    Int
  date        DateTime
  plannedData Json?
  analysis    Json?
  feedback    Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  Athlete     Athlete  @relation(fields: [athleteId], references: [id])
}

model training_gen_prompts {
  id                  String                @id
  name                String
  description         String?
  aiRoleId            String
  ruleSetId           String?
  mustHavesId         String
  returnFormatId      String
  createdAt           DateTime              @default(now())
  updatedAt           DateTime
  prompt_instructions prompt_instructions[]
  ai_roles            ai_roles              @relation(fields: [aiRoleId], references: [id])
  must_haves          must_haves            @relation(fields: [mustHavesId], references: [id])
  return_json_formats return_json_formats   @relation(fields: [returnFormatId], references: [id])
  rule_sets           rule_sets?            @relation(fields: [ruleSetId], references: [id])
}

model training_plan_days {
  id                   String               @id
  planId               String
  phaseId              String
  weekId               String
  date                 DateTime
  dayOfWeek            Int
  warmup               Json
  workout              Json
  cooldown             Json
  notes                String?
  createdAt            DateTime             @default(now())
  updatedAt            DateTime
  training_plan_phases training_plan_phases @relation(fields: [phaseId], references: [id], onDelete: Cascade)
  training_plans       training_plans       @relation(fields: [planId], references: [id], onDelete: Cascade)
  training_plan_weeks  training_plan_weeks  @relation(fields: [weekId], references: [id], onDelete: Cascade)

  @@unique([planId, date])
}

model training_plan_phases {
  id                     String                @id
  planId                 String
  name                   String
  weekCount              Int
  totalMiles             Float?
  phaseDescription       String?
  phaseTotalMilesTarget  Float?
  longRunProgression     Int[]                 @default([])
  qualityWorkoutsPerWeek Int                   @default(1)
  runTypesEnabled        Json?
  phaseStartDate         DateTime
  phaseEndDate           DateTime
  createdAt              DateTime              @default(now())
  updatedAt              DateTime
  training_plan_days     training_plan_days[]
  training_plans         training_plans        @relation(fields: [planId], references: [id], onDelete: Cascade)
  training_plan_weeks    training_plan_weeks[]

  @@unique([planId, name])
}

model training_plan_weeks {
  id                   String               @id
  planId               String
  phaseId              String
  weekNumber           Int
  miles                Float?
  createdAt            DateTime             @default(now())
  updatedAt            DateTime
  planningDays         Json?
  training_plan_days   training_plan_days[]
  training_plan_phases training_plan_phases @relation(fields: [phaseId], references: [id], onDelete: Cascade)
  training_plans       training_plans       @relation(fields: [planId], references: [id], onDelete: Cascade)

  @@unique([planId, weekNumber])
}

model training_plans {
  id                   String                 @id
  athleteId            String
  raceId               String?
  name                 String
  goalTime             String?
  goalRacePace         Int?
  predictedRacePace    Int?
  current5KPace        String?
  currentWeeklyMileage Int?
  preferredDays        Int[]
  startDate            DateTime
  totalWeeks           Int
  goalPace5K           String?
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  training_plan_days   training_plan_days[]
  training_plan_phases training_plan_phases[]
  training_plan_weeks  training_plan_weeks[]
  Athlete              Athlete                @relation(fields: [athleteId], references: [id])
  race_registry        race_registry?         @relation(fields: [raceId], references: [id])
}

model training_schemas {
  id          String   @id
  name        String   @unique
  description String?
  schemaJson  Json
  createdAt   DateTime @default(now())
  updatedAt   DateTime
}

enum Gender {
  male
  female
  both
}

enum RunCrewRole {
  member
  admin
  manager
}

enum State {
  AL
  AK
  AZ
  AR
  CA
  CO
  CT
  DE
  DC
  FL
  GA
  HI
  ID
  IL
  IN
  IA
  KS
  KY
  LA
  ME
  MD
  MA
  MI
  MN
  MS
  MO
  MT
  NE
  NV
  NH
  NJ
  NM
  NY
  NC
  ND
  OH
  OK
  OR
  PA
  RI
  SC
  SD
  TN
  TX
  UT
  VT
  VA
  WA
  WV
  WI
  WY
}

enum Purpose {
  Training
  Fun
  Social
}

enum TimePreference {
  Morning
  Afternoon
  Evening
}

enum TrainingForDistance {
  FiveK
  TenK
  HalfMarathon
  Marathon
  Ultra
}
