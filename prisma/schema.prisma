generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//
// COMPANY RELATION (just a FK reference)
//

model GoFastCompany {
  id        String    @id @default(cuid())
  name      String?
  slug      String?   @unique
  address   String?
  city      String?
  state     String?
  zip       String?
  domain    String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  athletes Athlete[]

  @@map("go_fast_companies")
}

//
// CORE GOFAST ATHLETE MODEL
//

model Athlete {
  id                      String    @id @default(cuid())
  firebaseId              String    @unique
  email                   String?
  companyId               String

  firstName               String?
  lastName                String?
  gofastHandle            String?   @unique
  photoURL                String?
  phoneNumber             String?

  birthday                DateTime?
  gender                  String?
  city                    String?
  state                   String?

  primarySport            String?
  bio                     String?
  instagram               String?

  // Garmin + Strava
  garmin_user_id          String?   @unique
  garmin_access_token     String?
  garmin_refresh_token    String?
  garmin_expires_in       Int?
  garmin_scope            String?
  garmin_connected_at     DateTime?
  garmin_last_sync_at     DateTime?
  garmin_is_connected     Boolean   @default(false)
  garmin_disconnected_at  DateTime?
  garmin_permissions      Json?
  garmin_user_profile     Json?
  garmin_user_sleep       Json?
  garmin_user_preferences Json?

  strava_id               Int?      @unique
  strava_access_token     String?
  strava_refresh_token    String?
  strava_expires_at       Int?

  // Derived performance metrics
  fiveKPace               String?

  weeklyMileage           Int?       // NEW FIELD

  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  company                 GoFastCompany @relation(fields: [companyId], references: [id], onDelete: Cascade)

  athlete_activities      athlete_activities[]

  training_days_executed  training_days_executed[]
}

//
// ACTIVITIES
//

model athlete_activities {
  id               String   @id @default(cuid())

  athleteId        String

  sourceActivityId String   @unique
  source           String   @default("garmin")
  activityType     String?
  activityName     String?

  startTime        DateTime?
  duration         Int?
  distance         Float?
  calories         Int?
  averageSpeed      Float?
  averageHeartRate Int?
  maxHeartRate     Int?
  elevationGain    Float?
  steps            Int?

  startLatitude    Float?
  startLongitude   Float?
  endLatitude      Float?
  endLongitude     Float?

  summaryPolyline  String?
  summaryData      Json?
  detailData       Json?

  hydratedAt       DateTime?

  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  Athlete          Athlete  @relation(fields: [athleteId], references: [id], onDelete: Cascade)
}

//
// EXECUTED TRAINING DAYS (NOT PLAN ENGINE)
//

model training_days_executed {
  id          String   @id @default(cuid())

  athleteId   String
  activityId  String?  @unique

  weekIndex   Int
  dayIndex    Int
  date        DateTime

  plannedData Json?
  analysis    Json?
  feedback    Json?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  Athlete     Athlete @relation(fields: [athleteId], references: [id], onDelete: Cascade)
}
